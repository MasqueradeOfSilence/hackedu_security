# Insufficient Logging and Monitoring

This is not a direct vulnerability, but rather a bad practice that can lead to other weaknesses. 

## Logging
Logs are automatically generated by a system and describe who, where, and why an event occurred. This information can be valuable to attackers as well as investigators of a cyberattack. 

## Monitoring 
Monitoring mechanisms should analyze log files for anomalies. However, automation is not sufficient. People are a component of monitoring. They should be manually checking the logs for suspicious activity as well. 

## Exercise 1: Reconnaissance

The simulated website looks pretty hipster, but what vulnerabilities might it have? Following the tutorial, we try an email of `drew@ecomcorpx.com` and a password of `password`, which returns "These credentials do not match our records." But then if we try `drew.brandon@ecomcorpx.com` and `password`, we get a more specific error: "The specified password does not match our records. Forgot your password? Contact Support to reset your password." 

So, we have the correct email address. to try and find the password would involve a brute force or dictionary attack. Note that the tutorial says `We can get a list of the most used passwords and perform a brute-force attack to try to get into the account`, which is worded somewhat poorly, as using a list of the most used passwords would technically constitute a dictionary attack (though, arguably you could consider a dictionary attack a subset of a brute-force attack because in some sense you are still technically brute-forcing, just with more information). 

This leakage of information is known as *improper error handling*. 

## Exercise 1: Exploitation 

This exercise had me use the Patator tool in Python, which was embedded inside of the app itself. 

`python patator.py http_fuzz url=http://10.0.0.1/phpmyadmin/index.php method=POST follow=1 body='pma_username=root&pma_password=FILE0&server=1&lang=en' 0=password.txt`

I needed the method: POST

And the URL: http://ecomcorpx.com/login 

And the body: `email=email%40whatever.com&password=lmao`

So now we go into the Kali Linux simulation. We use the following command: `python patator.py http_fuzz url=http://ecomcorpx.com/login method=POST follow=1 body='email=drew.brandon@ecomcorpx.com&password=FILE0' 0=password.txt` and see that `1qaz2wsx` returned a larger amount of bytes. So this must be his password. 

We sign in with email `drew.brandon@ecomcorpx.com` and password `1qaz2wsx`, and authenticate into the dashboard successfully. 

## Exercise 2

We now use the secure website and run `python patator.py http_fuzz url=http://secure.ecomcorpx.com/login method=POST follow=1 body='email=drew.brandon@ecomcorpx.com&password=FILE0' 0=password.txt` in Kali. The target password doesn't  have a larger size than any of the other passwords, so without our existing knowledge, we wouldn't know what it was. 

We then try 11 manual login attempts with random credentials. Sure enough, on the 11th attempt, we are locked out. 

## Defense

The tutorial lists the following defense principles: 
- Have backup log files. 
- Have detailed log responses so you can see which are good vs. malicious.; 
- Use monitoring tools.
- Do pentests. 
- Have an incident response and recovery plan. 
- Realize that these measures aren't enough on their own to ensure good security. You still need to prevent against other types of vulnerabilities. 

## Conclusion

This was a good module. I especially enjoyed working with the Kali simulation. 
